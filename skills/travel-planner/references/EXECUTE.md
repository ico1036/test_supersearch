# Travel Planner Execution Guide v1.2

## 실행 프롬프트 템플릿

사용자가 `/travel-planner` 또는 여행 관련 요청을 하면 다음 단계로 실행:

---

## Phase 1: 정보 수집 및 시간대 분석

```
사용자 요청을 파싱하여 다음 정보 확인:

필수 정보:
- location: [추출 또는 질문]
- theme: [추출 또는 질문]
- date: [추출 또는 질문]
- time_range: [추출 또는 질문] ← 시간대 분석 중요!
- group_size: [추출 또는 질문]

선택 정보:
- budget: [추출]
- preferences: [추출]
- exclusions: [추출]

누락된 필수 정보가 있으면 AskUserQuestion 도구로 수집
```

### 시간대 분석 (필수)

```javascript
// 시간대에 따른 코스 구성
IF time_range.start < 10:00:
  → 아침 식사 코스 필수 포함
  → "아침 오픈 맛집" 별도 검색

IF time_range includes 10:00-12:00:
  → 브런치 옵션 검색

IF time_range includes 12:00-14:00:
  → 점심 맛집 + 피크타임 회피 전략

IF time_range includes 14:00-17:00:
  → 카페 타임 포함

IF time_range includes 18:00-21:00:
  → 저녁 맛집 검색
```

---

## Phase 2: 병렬 검색 실행 (개선됨)

**한 번의 메시지에서 시간대별 + 로컬 맛집 검색 동시 실행:**

```javascript
// 검색 1: 아침 식사 (시간대에 따라)
WebSearch({
  query: "{location} 아침식사 맛집 오전 오픈 현지인"
})

// 검색 2: 점심 맛집 - 로컬/숨은 맛집 우선
WebSearch({
  query: "{location} 숨은 맛집 현지인 추천 웨이팅없는"
})

// 검색 3: 카페 - 숨은 카페 우선
WebSearch({
  query: "{location} 숨은 카페 로컬 분위기 좋은"
})

// 검색 4: 혼잡도/피크타임 정보
WebSearch({
  query: "{location} 맛집 웨이팅 대기시간 피크타임 한산한시간"
})

// 검색 5: 다이닝코드/식신 직접 검색 (접근 가능 소스)
WebSearch({
  query: "site:diningcode.com {location} 맛집"
})
WebSearch({
  query: "site:siksinhot.com {location} 맛집"
})
```

### ⚠️ 검색 소스 필터링

```
✅ 우선 사용 (접근 가능):
  - diningcode.com
  - siksinhot.com
  - 네이버 플레이스
  - 카카오맵
  - 망고플레이트

❌ 피해야 할 소스:
  - brunch.co.kr (접근 제한)
  - 개인 블로그 (링크 만료 위험)
  - "XX 가볼만한곳" 류 일반 포스트 (무의미)
```

---

## Phase 3: 개별 장소 검증 (5항목)

각 후보 장소에 대해 추가 검색:

```javascript
// 장소별 상세 검증 - 5항목
WebSearch({
  query: "{장소명} 영업시간 {요일}"
})

WebSearch({
  query: "{장소명} 주소 위치"
})

WebSearch({
  query: "{장소명} 웨이팅 대기시간 피크타임"  // NEW: 혼잡도
})

WebSearch({
  query: "{장소명} site:diningcode.com"  // 접근 가능 소스 확보
})
```

---

## Phase 4: 검증 체크리스트 적용 (5항목)

각 장소에 대해 다음 확인:

```markdown
### {장소명} 검증 결과

| 항목 | 상태 | 상세 |
|------|------|------|
| 영업 상태 | ✅/❌/⚠️ | {최근 리뷰 날짜, 영업 확인} |
| 위치 적합 | ✅/❌/⚠️ | {이전 장소에서 도보 X분/차량 X분} |
| 시간 적합 | ✅/❌/⚠️ | {영업시간, 브레이크타임 여부} |
| 인원 수용 | ✅/❌/⚠️ | {최대 수용 인원, 예약 필요 여부} |
| 혼잡도 | ✅/❌/⚠️ | {피크타임, 웨이팅 예상, 한산한 시간} | ← NEW

추천 이유: {왜 이 시간대에 이 장소인지 구체적으로}
소스: [다이닝코드](url) | [식신](url)
```

---

## Phase 5: 추천 우선순위 적용

### ❌ 제외해야 할 추천

```
1. 해당 지역 외 장소
   - 명주동 요청에 중앙시장 추천 → ❌ (굳이 이동 필요 없음)

2. 뻔한 관광지
   - 너무 유명해서 항상 붐비는 곳 → 피크타임 웨이팅 30분+

3. 접근 불가 링크
   - 브런치, 개인 블로그 → 대체 소스 찾기

4. 일반 관광 정보
   - "XX 가볼만한곳" 류 포스트 → 무의미
```

### ✅ 우선 추천

```
1. 해당 지역 내 로컬 맛집
   - 동네 주민이 자주 가는 곳
   - 관광객보다 현지인 비율 높은 곳

2. 숨은 맛집/카페
   - 골목 안쪽에 위치
   - 인스타 유명세 없이 맛으로 승부

3. 시간대별 최적 장소
   - 아침엔 아침 전문점 (국밥, 베이커리 등)
   - 브런치엔 브런치 카페
   - 점심엔 웨이팅 적은 로컬 맛집

4. 혼잡도 낮은 대안
   - 같은 퀄리티인데 덜 붐비는 곳
```

---

## Phase 6: 결과 포맷팅 (개선됨)

### 기본 출력 구조:

```markdown
# 🗺️ {theme} 여행 코스 - {location}

## 📋 여행 개요
| 항목 | 내용 |
|------|------|
| 날짜 | {date} |
| 시간 | {time_range} |
| 인원 | {group_size} |
| 테마 | {theme} |

---

## 🚶 추천 코스

### ⏰ 08:00-10:00 | 아침 식사 ☀️

**🏆 메인 추천: {장소명}**
- 📍 주소: {주소}
- ⏰ 영업: {영업시간} | 아침 {X}시 오픈
- 👥 수용: {인원}
- 💰 가격: {가격대}
- 🚶 혼잡도: {한산/보통/혼잡} | 추천 방문 시간: {X}시
- 💡 **추천 이유**:
  - {구체적 이유 1: 왜 이 시간대에?}
  - {구체적 이유 2: 왜 이 장소?}
  - {구체적 이유 3: 숨은 맛집/로컬 이유}
- 🔗 [다이닝코드](url) | [식신](url)

**📋 대안 옵션 (5개)**

| # | 장소명 | 추천 이유 | 오픈 | 혼잡도 | 가격 | 소스 |
|---|--------|-----------|------|--------|------|------|
| 1 | {name} | {구체적 이유} | 07:00 | 한산 | ₩8,000 | [링크](url) |
| 2 | {name} | {구체적 이유} | 08:00 | 보통 | ₩10,000 | [링크](url) |
| 3 | {name} | {구체적 이유} | 07:30 | 한산 | ₩9,000 | [링크](url) |
| 4 | {name} | {구체적 이유} | 08:00 | 한산 | ₩8,500 | [링크](url) |
| 5 | {name} | {구체적 이유} | 09:00 | 보통 | ₩12,000 | [링크](url) |

---

### ⏰ 12:00-14:00 | 점심 식사 🍜

**🏆 메인 추천: {장소명}**
- 📍 주소: {주소}
- ⏰ 영업: {영업시간}
- 👥 수용: {인원}
- 💰 가격: {가격대}
- 🚶 혼잡도: 피크타임 12:30-13:30 | 웨이팅 {X}분 예상
- ⏱️ **피크 회피 전략**: 11:30 또는 14:00 이후 방문 권장
- 💡 **추천 이유**:
  - {구체적 이유: 숨은 맛집인 이유}
  - {구체적 이유: 현지인 추천 이유}
- 🔗 [다이닝코드](url) | [식신](url)

---

### ⏰ 14:00-16:00 | 카페 타임 ☕

**🏆 메인 추천: {장소명}**
- 📍 주소: {주소}
- ⏰ 영업: {영업시간}
- 🪑 좌석: {좌석 수/분위기}
- 💰 가격: 아메리카노 {X}원
- 🚶 혼잡도: 오후 {X}시 이후 한산
- 💡 **추천 이유**:
  - {구체적 이유: 왜 이 카페?}
  - {구체적 이유: 분위기/뷰/숨은 장소}
  - {테마 연관 이유: 임장/힐링 등 테마에 맞는 이유}
- 🔗 [다이닝코드](url) | [식신](url)
```

---

## 추천 이유 작성 가이드

### ✅ 좋은 예시

```markdown
💡 **추천 이유**:
- 명주동 골목 안쪽에 위치해 관광객 적음
- 오전 11시 전 방문시 웨이팅 없음
- 적산가옥 개조 카페로 임장 테마에 적합
- 현지인 단골 비율 70% 이상
- 오후 3시 이후 한산해서 대화하기 좋음
```

### ❌ 나쁜 예시

```markdown
💡 추천 이유: 유명한 맛집입니다.
💡 추천 이유: 분위기가 좋습니다.
💡 추천 이유: 맛있습니다.
```

---

## 에러 핸들링 (개선됨)

```markdown
### 접근 불가 링크 발견시

브런치, 개인 블로그 링크 → 즉시 대체 소스 검색
WebSearch: "{장소명} site:diningcode.com"
WebSearch: "{장소명} site:siksinhot.com"
```

```markdown
### 해당 지역 외 추천 방지

"명주동" 요청 → "중앙시장" 추천 ❌
→ 명주동 내 옵션 재검색
→ 해당 골목/거리 내 숨은 맛집 검색
```

```markdown
### 모든 곳이 붐비는 경우

피크타임 회피 전략 제시:
1. 오픈 직후 방문 (11:00 전)
2. 피크 이후 방문 (14:00 이후)
3. 웨이팅 없는 대안 장소 우선 제시
```

---

## 검색 쿼리 최적화 팁 (개선됨)

```markdown
### 효과적인 검색 쿼리 패턴

1. 숨은 맛집: "{location} 숨은 맛집 현지인 로컬"
2. 아침 식사: "{location} 아침식사 맛집 오전 오픈"
3. 혼잡도: "{장소명} 웨이팅 대기시간 피크타임"
4. 한산한 시간: "{location} 맛집 한산한 시간 점심"
5. 접근 가능 소스: "site:diningcode.com {location}"
6. 현지인 맛집: "{location} 현지인 추천 관광객 없는"

### 피해야 할 쿼리

❌ "{location} 가볼만한곳" → 일반 관광 정보만 나옴
❌ "{location} 맛집 추천" → 뻔한 결과
❌ "{location} 유명 맛집" → 항상 붐비는 곳
```

---

## 체크리스트 (실행 전 확인)

```
□ 시간대 분석 완료 (아침 코스 필요 여부 확인)
□ 아침 식사 코스 포함 (시간대에 따라)
□ 5개 병렬 검색 실행 (시간대별 + 로컬 맛집)
□ 각 장소 5항목 검증 완료 (혼잡도 포함)
□ 5개 이상 대안 옵션 제시
□ 모든 장소에 "추천 이유" 구체적 명시
□ 모든 소스 링크 접근 가능 확인 (브런치 제외)
□ 해당 지역 내 장소만 추천 (다른 지역 추천 금지)
□ 숨은 맛집/로컬 맛집 우선 배치
□ 피크타임 회피 전략 포함
□ 검증 요약 테이블 포함
□ results/ 디렉토리에 MD 파일 저장 완료 ← 필수!
```

---

## Phase 7: MD 파일 저장 (필수)

스킬 실행 완료 후 반드시 결과를 MD 파일로 저장:

### 저장 규칙

```
저장 위치: results/
파일명: {location}-travel-plan-{YYYY-MM}.md
인코딩: UTF-8
```

### 저장 프로세스

```javascript
// Phase 7: 결과 저장
Write({
  file_path: "results/{location}-travel-plan-{YYYY-MM}.md",
  content: [전체 마크다운 결과]
})
```

### 저장 후 확인

```
✅ 파일 저장 완료: results/{filename}.md
```

---

## Version History

| 버전 | 날짜 | 변경 사항 |
|------|------|-----------|
| 1.0.0 | 2025-01 | 초기 버전 |
| 1.1.0 | 2025-01 | MD 파일 저장 추가 |
| 1.2.0 | 2025-01 | 혼잡도 체크, 숨은 맛집 우선, 접근 가능 링크만, 추천 이유 필수, 아침 코스 필수 |
